pipeline
{
    agent any
    tools{
        maven 'Maven'
    }
 environment {
    IMAGE_NAME = 'anirudhnikhil/spring'
    IMAGE_TAG = 'latest'
  }

    stages{
        stage('checkout')
        {
            steps
            {
                echo 'checkout successfully completed'
    }
}
        stage('Build')
        {
            steps{
                echo 'build started'
                sh 'cd java-based/spring-boot-app'
                echo 'build succed'
            }
            
        }    
       stage('test')
        {
            steps{
                echo 'test started'
                sh 'cd java-based/spring-boot-app && mvn test'
                echo 'test succed'
            }
            
        }  
stage('Build Docker Image') {
      steps {
        script {
          sh "docker build -t ${IMAGE_NAME}:${IMAGE_TAG} ."
        }
      }
    }

    stage('Push to DockerHub') {
      steps {
        script {
          withCredentials([usernamePassword(credentialsId: 'docker-cred', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
            sh """
              echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
              docker push ${IMAGE_NAME}:${IMAGE_TAG}
              docker logout
            """
          }
        }
      }
    }
  }
}
    }

